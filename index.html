<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á ATV ‚Äì ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡πá‡∏°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    h1,
    h2,
    h3 {
      margin: 0 0 12px;
      color: #f9fafb;
    }

    h1 {
      font-size: 1.8rem;
    }

    h2 {
      font-size: 1.3rem;
      margin-top: 8px;
    }

    h3 {
      font-size: 1rem;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.1fr 1.4fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #020617;
      border-radius: 18px;
      padding: 16px 16px 18px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
      border: 1px solid #1f2937;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .card-header small {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    label {
      font-size: 0.8rem;
      color: #9ca3af;
      display: block;
      margin-bottom: 4px;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    .row-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    .field {
      margin-bottom: 8px;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.85rem;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.6);
      background: #020617;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.08s ease-out, box-shadow 0.1s ease-out,
        background 0.1s;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #22d3ee);
      color: #020617;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(34, 197, 94, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(34, 197, 94, 0.45);
    }

    .btn-ghost {
      background: transparent;
      color: #9ca3af;
      border: 1px solid #374151;
      padding-inline: 10px;
    }

    .btn-ghost:hover {
      background: #020617;
      color: #e5e7eb;
    }

    .btn-danger {
      background: transparent;
      color: #f97373;
      border: 1px solid #4b1212;
      padding-inline: 10px;
    }

    .btn-danger:hover {
      background: #1b0707;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 0.75rem;
      border-radius: 999px;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 12px 0 6px;
      flex-wrap: wrap;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #111827;
      color: #9ca3af;
      border: 1px solid #1f2937;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      margin-top: 6px;
    }

    th,
    td {
      padding: 6px 6px;
      border-bottom: 1px solid #111827;
      vertical-align: top;
    }

    th {
      text-align: left;
      font-weight: 600;
      color: #9ca3af;
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background: #020617;
    }

    .table-container {
      max-height: 360px;
      overflow: auto;
      margin-top: 4px;
      border-radius: 12px;
      border: 1px solid #111827;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: #111827;
      color: #9ca3af;
      gap: 4px;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
    }

    .pill-type-1 .pill-dot {
      background: #22c55e;
    }

    .pill-type-2 .pill-dot {
      background: #fb923c;
    }

    .pill-type-3 .pill-dot {
      background: #38bdf8;
    }

    .muted {
      color: #6b7280;
      font-size: 0.75rem;
    }

    .nowrap {
      white-space: nowrap;
    }

    .text-right {
      text-align: right;
    }

    .summary {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .summary-item {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #111827;
      background: #020617;
    }

    .tag {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #111827;
      color: #9ca3af;
      border: 1px solid #1f2937;
    }

    .empty-state {
      padding: 14px;
      text-align: center;
      font-size: 0.8rem;
      color: #6b7280;
    }

    .footer-note {
      margin-top: 16px;
      font-size: 0.7rem;
      color: #6b7280;
      text-align: center;
    }

    .btn-group-right {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .file-input-hidden {
      display: none;
    }
  </style>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#22c55e">
</head>
<body>
  <div class="app">
    <header>
      <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á ATV</h1>
      <div class="subtitle">
        ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏° ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á ATV | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á
      </div>
    </header>

    <main class="grid">
      <!-- ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ + ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
      <section>
        <div class="card" id="vehicle-card">
          <div class="card-header">
            <div>
              <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ ATV</h2>
              <small>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î</small>
            </div>
            <button class="btn btn-ghost btn-sm" id="btnClearVehicle">
              ‡∏•‡πâ‡∏≤‡∏á
            </button>
          </div>

          <div class="field">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡∏ñ / ‡∏£‡∏´‡∏±‡∏™‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ATV-01)</label>
            <input id="vehicleName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ATV-01 / ‡∏Ñ‡∏±‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á" />
          </div>

          <div class="row">
            <div class="field">
              <label>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
              <input id="vehicleBrand" placeholder="‡πÄ‡∏ä‡πà‡∏ô Honda, CF-Moto" />
            </div>
            <div class="field">
              <label>‡∏£‡∏∏‡πà‡∏ô</label>
              <input id="vehicleModel" placeholder="‡πÄ‡∏ä‡πà‡∏ô 250cc Off-road" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï</label>
              <input id="vehicleYear" type="number" min="1980" max="2100" />
            </div>
            <div class="field">
              <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
              <input id="vehiclePurchaseDate" type="date" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>‡πÄ‡∏•‡∏Ç‡∏ï‡∏±‡∏ß‡∏£‡∏ñ (VIN)</label>
              <input id="vehicleVin" />
            </div>
            <div class="field">
              <label>‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå</label>
              <input id="vehicleEngineNo" />
            </div>
          </div>

          <div class="field">
            <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
            <textarea id="vehicleNote" placeholder="‡∏™‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏î‡∏¥‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ"></textarea>
          </div>

          <button class="btn btn-primary" id="btnSaveVehicle">
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ
          </button>
        </div>

        <div style="height: 10px"></div>

        <div class="card">
          <div class="card-header">
            <div>
              <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏° / ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</h2>
              <small>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏ã‡πà‡∏≠‡∏°</small>
            </div>
          </div>

          <form id="logForm">
            <div class="row">
              <div class="field">
                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ <span class="tag">‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</span></label>
                <input type="date" id="logDate" required />
              </div>
              <div class="field">
                <label>‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå / ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏°</label>
                <input
                  type="number"
                  step="0.1"
                  id="logOdo"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô 125.5"
                />
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                <select id="logType">
                  <option value="service">‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞</option>
                  <option value="repair">‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢</option>
                  <option value="upgrade">‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á / ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î</option>
                </select>
              </div>
              <div class="field">
                <label>‡∏ú‡∏π‡πâ‡∏ã‡πà‡∏≠‡∏° / ‡∏£‡πâ‡∏≤‡∏ô</label>
                <input id="logMechanic" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡πâ‡∏≤‡∏ô A / ‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏≠‡∏á" />
              </div>
            </div>

            <div class="field">
              <label>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏°</label>
              <textarea
                id="logSymptom"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏¢‡∏≤‡∏Å ‡∏£‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ô‡∏¥‡πà‡∏á ‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡πÅ‡∏õ‡∏•‡∏Å‡πÜ"
              ></textarea>
            </div>

            <div class="field">
              <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥</label>
              <textarea
                id="logWork"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á, ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô, ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®"
              ></textarea>
            </div>

            <div class="field">
              <label>‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label>
              <textarea
                id="logParts"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏±‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô NGK CPR7EA-9 1 ‡∏ï‡∏±‡∏ß, ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á 10W-40 1 ‡∏•‡∏¥‡∏ï‡∏£"
              ></textarea>
            </div>

            <div class="row-3">
              <div class="field">
                <label>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á (‡∏ö‡∏≤‡∏ó)</label>
                <input
                  type="number"
                  step="0.01"
                  id="logLabor"
                  placeholder="0.00"
                />
              </div>
              <div class="field">
                <label>‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà (‡∏ö‡∏≤‡∏ó)</label>
                <input
                  type="number"
                  step="0.01"
                  id="logPartsCost"
                  placeholder="0.00"
                />
              </div>
              <div class="field">
                <label>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏ö‡∏≤‡∏ó)</label>
                <input
                  type="number"
                  step="0.01"
                  id="logOtherCost"
                  placeholder="0.00"
                />
              </div>
            </div>

            <div class="field">
              <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
              <textarea
                id="logNote"
                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏±‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ 200 ‡∏Å‡∏°. ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö"
              ></textarea>
            </div>

            <button class="btn btn-primary" type="submit">
              ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </button>
            <button
              class="btn btn-ghost"
              type="button"
              id="btnResetForm"
              style="margin-left: 6px"
            >
              ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            </button>
          </form>
        </div>
      </section>

      <!-- ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ + ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏° -->
      <section>
        <div class="card">
          <div class="card-header">
            <div>
              <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á</h2>
              <small id="vehicleLabelDisplay">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ATV</small>
            </div>
            <div class="btn-group-right">
              <button class="btn btn-ghost btn-sm" id="btnExport">
                üì§ Export
              </button>

              <label class="btn btn-ghost btn-sm">
                üì• Import
                <input type="file" id="importFile" class="file-input-hidden" />
              </label>

              <button class="btn btn-danger btn-sm" id="btnClearAllLogs">
                ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
              </button>
            </div>
          </div>

          <div class="summary" id="summaryBar">
            <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
          </div>

          <div class="section-title">
            <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
            <span class="badge">‡∏£‡∏ß‡∏°: ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á + ‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà + ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</span>
          </div>
          <div id="monthlySummary" class="summary">
            <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
          </div>

          <div class="table-container" id="tableContainer">
            <table>
              <thead>
                <tr>
                  <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                  <th>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á/‡∏ä‡∏°.</th>
                  <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                  <th>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ / ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</th>
                  <th class="text-right">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</th>
                  <th>‡∏ú‡∏π‡πâ‡∏ã‡πà‡∏≠‡∏°</th>
                  <th class="text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
              </thead>
              <tbody id="logTableBody">
                <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
              </tbody>
            </table>
          </div>
          <div class="empty-state" id="emptyState">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ üëà
          </div>
        </div>

        <div class="footer-note">
          * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (LocalStorage) ‡∏´‡∏≤‡∏Å‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå / ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ï‡∏≤‡∏°‡πÑ‡∏õ | ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° Export / Import ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
        </div>
      </section>
    </main>
  </div>

  <script>
    const STORAGE_KEY_VEHICLE = "atv_vehicle_info";
    const STORAGE_KEY_LOGS = "atv_maintenance_logs";

    const vehicleFields = {
      name: document.getElementById("vehicleName"),
      brand: document.getElementById("vehicleBrand"),
      model: document.getElementById("vehicleModel"),
      year: document.getElementById("vehicleYear"),
      purchaseDate: document.getElementById("vehiclePurchaseDate"),
      vin: document.getElementById("vehicleVin"),
      engineNo: document.getElementById("vehicleEngineNo"),
      note: document.getElementById("vehicleNote"),
    };

    const btnSaveVehicle = document.getElementById("btnSaveVehicle");
    const btnClearVehicle = document.getElementById("btnClearVehicle");
    const vehicleLabelDisplay = document.getElementById("vehicleLabelDisplay");

    const logForm = document.getElementById("logForm");
    const btnResetForm = document.getElementById("btnResetForm");
    const btnClearAllLogs = document.getElementById("btnClearAllLogs");
    const logTableBody = document.getElementById("logTableBody");
    const emptyState = document.getElementById("emptyState");
    const summaryBar = document.getElementById("summaryBar");
    const monthlySummary = document.getElementById("monthlySummary");

    const logDate = document.getElementById("logDate");
    const logOdo = document.getElementById("logOdo");
    const logType = document.getElementById("logType");
    const logMechanic = document.getElementById("logMechanic");
    const logSymptom = document.getElementById("logSymptom");
    const logWork = document.getElementById("logWork");
    const logParts = document.getElementById("logParts");
    const logLabor = document.getElementById("logLabor");
    const logPartsCost = document.getElementById("logPartsCost");
    const logOtherCost = document.getElementById("logOtherCost");
    const logNote = document.getElementById("logNote");

    const btnExport = document.getElementById("btnExport");

    let editingIndex = null;
    const importFile = document.getElementById("importFile");

    function loadVehicleInfo() {
      const raw = localStorage.getItem(STORAGE_KEY_VEHICLE);
      if (!raw) {
        updateVehicleLabel();
        return;
      }
      try {
        const data = JSON.parse(raw);
        vehicleFields.name.value = data.name || "";
        vehicleFields.brand.value = data.brand || "";
        vehicleFields.model.value = data.model || "";
        vehicleFields.year.value = data.year || "";
        vehicleFields.purchaseDate.value = data.purchaseDate || "";
        vehicleFields.vin.value = data.vin || "";
        vehicleFields.engineNo.value = data.engineNo || "";
        vehicleFields.note.value = data.note || "";
      } catch (e) {
        console.error("vehicle parse error", e);
      }
      updateVehicleLabel();
    }

    function saveVehicleInfo() {
      const payload = {
        name: vehicleFields.name.value.trim(),
        brand: vehicleFields.brand.value.trim(),
        model: vehicleFields.model.value.trim(),
        year: vehicleFields.year.value.trim(),
        purchaseDate: vehicleFields.purchaseDate.value,
        vin: vehicleFields.vin.value.trim(),
        engineNo: vehicleFields.engineNo.value.trim(),
        note: vehicleFields.note.value.trim(),
      };
      localStorage.setItem(STORAGE_KEY_VEHICLE, JSON.stringify(payload));
      updateVehicleLabel();
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡πÅ‡∏•‡πâ‡∏ß");
    }

    function clearVehicleInfo() {
      if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
      Object.values(vehicleFields).forEach((el) => (el.value = ""));
      localStorage.removeItem(STORAGE_KEY_VEHICLE);
      updateVehicleLabel();
    }

    function updateVehicleLabel() {
      const raw = localStorage.getItem(STORAGE_KEY_VEHICLE);
      let label = "‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ATV";
      if (raw) {
        try {
          const data = JSON.parse(raw);
          const pieces = [];
          if (data.name) pieces.push(data.name);
          if (data.brand || data.model)
            pieces.push([data.brand, data.model].filter(Boolean).join(" "));
          if (pieces.length) label = "‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö " + pieces.join(" | ");
        } catch (e) {}
      }
      vehicleLabelDisplay.textContent = label;
    }

    function loadLogs() {
      const raw = localStorage.getItem(STORAGE_KEY_LOGS);
      if (!raw) return [];
      try {
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) return arr;
      } catch (e) {
        console.error("logs parse error", e);
      }
      return [];
    }

    function saveLogs(logs) {
      localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(logs));
    }

    function formatNumber(n) {
      const num = Number(n);
      if (isNaN(num)) return "-";
      return num.toLocaleString("th-TH", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      });
    }

    function formatDate(d) {
      if (!d) return "-";
      try {
        const date = new Date(d);
        if (isNaN(date.getTime())) return d;
        return date.toLocaleDateString("th-TH", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      } catch (e) {
        return d;
      }
    }

    function typeToLabel(t) {
      switch (t) {
        case "service":
          return { text: "‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤", cls: "pill-type-1" };
        case "repair":
          return { text: "‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢", cls: "pill-type-2" };
        case "upgrade":
          return { text: "‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á / ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î", cls: "pill-type-3" };
        default:
          return { text: "‡∏≠‡∏∑‡πà‡∏ô‡πÜ", cls: "" };
      }
    }

    function renderLogs() {
      const logs = loadLogs().sort((a, b) => {
        const da = a.date || "";
        const db = b.date || "";
        if (da === db) return 0;
        return da < db ? 1 : -1;
      });

      logTableBody.innerHTML = "";

      if (!logs.length) {
        emptyState.style.display = "block";
      } else {
        emptyState.style.display = "none";
      }

      let totalCostAll = 0;
      let serviceCount = 0;
      let repairCount = 0;
      let upgradeCount = 0;
      const monthlyMap = {};

      logs.forEach((log, index) => {
        const tr = document.createElement("tr");

        const totalCost =
          (Number(log.labor) || 0) +
          (Number(log.partsCost) || 0) +
          (Number(log.otherCost) || 0);

        totalCostAll += totalCost;

        if (log.type === "service") serviceCount++;
        else if (log.type === "repair") repairCount++;
        else if (log.type === "upgrade") upgradeCount++;

        if (log.date) {
          const ym = String(log.date).slice(0, 7); // YYYY-MM
          monthlyMap[ym] = (monthlyMap[ym] || 0) + totalCost;
        }

        const typeInfo = typeToLabel(log.type);

        const tdDate = document.createElement("td");
        tdDate.textContent = formatDate(log.date);

        const tdOdo = document.createElement("td");
        tdOdo.className = "nowrap";
        tdOdo.textContent = log.odo ? log.odo + "" : "-";

        const tdType = document.createElement("td");
        tdType.innerHTML = `
          <span class="pill ${typeInfo.cls}">
            <span class="pill-dot"></span>
            ${typeInfo.text}
          </span>
        `;

        const tdWork = document.createElement("td");
        const symptomText = log.symptom ? log.symptom : "";
        const workText = log.work ? log.work : "";
        const partsText = log.parts ? log.parts : "";
        tdWork.innerHTML = `
          <div><strong>${workText || "-"}</strong></div>
          ${
            partsText
              ? `<div class="muted">‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà: ${partsText}</div>`
              : ""
          }
          ${
            symptomText
              ? `<div class="muted">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£: ${symptomText}</div>`
              : ""
          }
        `;

        const tdCost = document.createElement("td");
        tdCost.className = "text-right nowrap";
        tdCost.textContent = totalCost ? formatNumber(totalCost) : "-";

        const tdMechanic = document.createElement("td");
        tdMechanic.textContent = log.mechanic || "-";

        const tdActions = document.createElement("td");
        tdActions.className = "text-right nowrap";

        const btnView = document.createElement("button");
        btnView.textContent = "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î";
        btnView.className = "btn btn-ghost btn-sm";
        btnView.addEventListener("click", () => {
          showDetail(log);
        });

        const btnEdit = document.createElement("button");
        btnEdit.textContent = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
        btnEdit.className = "btn btn-ghost btn-sm";
        btnEdit.style.marginLeft = "4px";
        btnEdit.addEventListener("click", () => {
          editLog(index);
        });

        const btnDelete = document.createElement("button");
        btnDelete.textContent = "‡∏•‡∏ö";
        btnDelete.className = "btn btn-danger btn-sm";
        btnDelete.style.marginLeft = "4px";
        btnDelete.addEventListener("click", () => {
          deleteLog(index);
        });

        tdActions.appendChild(btnView);
        tdActions.appendChild(btnEdit);
        tdActions.appendChild(btnDelete);

        tr.appendChild(tdDate);
        tr.appendChild(tdOdo);
        tr.appendChild(tdType);
        tr.appendChild(tdWork);
        tr.appendChild(tdCost);
        tr.appendChild(tdMechanic);
        tr.appendChild(tdActions);

        logTableBody.appendChild(tr);
      });

      // ‡∏™‡∏£‡∏∏‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
      const logsCount = logs.length;
      summaryBar.innerHTML = "";
      const items = [];

      items.push(
        `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>${logsCount}</strong> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`,
        `‡∏ã‡πà‡∏≠‡∏°: <strong>${repairCount}</strong>`,
        `‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤: <strong>${serviceCount}</strong>`,
        `‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î: <strong>${upgradeCount}</strong>`,
        `‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°: <strong>${formatNumber(totalCostAll)}</strong> ‡∏ö‡∏≤‡∏ó`
      );

      items.forEach((t) => {
        const span = document.createElement("div");
        span.className = "summary-item";
        span.innerHTML = t;
        summaryBar.appendChild(span);
      });

      // ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
      monthlySummary.innerHTML = "";
      const months = Object.keys(monthlyMap).sort();
      if (!months.length) {
        const span = document.createElement("div");
        span.className = "summary-item";
        span.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô";
        monthlySummary.appendChild(span);
      } else {
        months.forEach((mKey) => {
          const span = document.createElement("div");
          span.className = "summary-item";
          span.innerHTML = `${mKey}: <strong>${formatNumber(
            monthlyMap[mKey]
          )}</strong> ‡∏ö‡∏≤‡∏ó`;
          monthlySummary.appendChild(span);
        });
      }
    }

    function deleteLog(index) {
      if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
      const logs = loadLogs();
      logs.splice(index, 1);
      saveLogs(logs);
      renderLogs();
    }

    function showDetail(log) {
      const parts = [];
      parts.push("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: " + formatDate(log.date));
      if (log.odo) parts.push("‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå/‡∏ä‡∏°.: " + log.odo);
      parts.push("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: " + typeToLabel(log.type).text);
      if (log.mechanic) parts.push("‡∏ú‡∏π‡πâ‡∏ã‡πà‡∏≠‡∏°/‡∏£‡πâ‡∏≤‡∏ô: " + log.mechanic);
      if (log.symptom) parts.push("\n‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡πà‡∏≠‡∏°:\n" + log.symptom);
      if (log.work) parts.push("\n‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥:\n" + log.work);
      if (log.parts) parts.push("\n‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:\n" + log.parts);

      const labor = Number(log.labor) || 0;
      const pcost = Number(log.partsCost) || 0;
      const ocost = Number(log.otherCost) || 0;
      const total = labor + pcost + ocost;

      parts.push(
        `\n‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á: ${formatNumber(labor)} ‡∏ö‡∏≤‡∏ó` +
          `\n‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà: ${formatNumber(pcost)} ‡∏ö‡∏≤‡∏ó` +
          `\n‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ: ${formatNumber(ocost)} ‡∏ö‡∏≤‡∏ó` +
          `\n‡∏£‡∏ß‡∏°: ${formatNumber(total)} ‡∏ö‡∏≤‡∏ó`
      );

      if (log.note) parts.push("\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:\n" + log.note);

      alert(parts.join("\n"));
    }

    function handleFormSubmit(e) {
      e.preventDefault();
      const dateValue = logDate.value;
      if (!dateValue) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà");
        return;
      }

      const newLog = {
        id: Date.now(),
        date: dateValue,
        odo: logOdo.value ? Number(logOdo.value) : null,
        type: logType.value,
        mechanic: logMechanic.value.trim(),
        symptom: logSymptom.value.trim(),
        work: logWork.value.trim(),
        parts: logParts.value.trim(),
        labor: logLabor.value ? Number(logLabor.value) : 0,
        partsCost: logPartsCost.value ? Number(logPartsCost.value) : 0,
        otherCost: logOtherCost.value ? Number(logOtherCost.value) : 0,
        note: logNote.value.trim(),
      };

      const logs = loadLogs();
      if (editingIndex !== null) {
        logs[editingIndex] = { ...newLog, id: logs[editingIndex].id };
        editingIndex = null;
        const submitBtn = logForm.querySelector('button[type="submit"]');
        if (submitBtn) submitBtn.textContent = "‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
      } else {
        logs.push(newLog);
      }
      saveLogs(logs);
      renderLogs();
      logForm.reset();
      setDefaultDate();
    }

    function setDefaultDate() {
      const today = new Date().toISOString().slice(0, 10);
      logDate.value = today;
    }

    function resetForm() {
      logForm.reset();
      setDefaultDate();
    }

    function clearAllLogs() {
      if (
        !confirm(
          "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á ATV ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)"
        )
      )
        return;
      localStorage.removeItem(STORAGE_KEY_LOGS);
      renderLogs();
    }

    // --- Export / Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ---
    function exportData() {
      const vehicle = localStorage.getItem(STORAGE_KEY_VEHICLE) || "{}";
      const logs = localStorage.getItem(STORAGE_KEY_LOGS) || "[]";
      const payload = {
        vehicle: JSON.parse(vehicle),
        logs: JSON.parse(logs),
      };
      const blob = new Blob([JSON.stringify(payload)], {
        type: "application/json",
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "ATV_backup.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const data = JSON.parse(e.target.result);
          if (data.vehicle) {
            localStorage.setItem(
              STORAGE_KEY_VEHICLE,
              JSON.stringify(data.vehicle)
            );
          }
          if (data.logs) {
            localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(data.logs));
          }
          alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          loadVehicleInfo();
          renderLogs();
        } catch (err) {
          alert("‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        }
      };
      reader.readAsText(file);
      // reset value ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
      event.target.value = "";
    }

    
    function editLog(index) {
      const logs = loadLogs();
      const log = logs[index];
      if (!log) return;
      logDate.value = log.date || "";
      logOdo.value = log.odo || "";
      logType.value = log.type || "service";
      logMechanic.value = log.mechanic || "";
      logSymptom.value = log.symptom || "";
      logWork.value = log.work || "";
      logParts.value = log.parts || "";
      logLabor.value = log.labor || 0;
      logPartsCost.value = log.partsCost || 0;
      logOtherCost.value = log.otherCost || 0;
      logNote.value = log.note || "";
      editingIndex = index;
      const submitBtn = logForm.querySelector('button[type="submit"]');
      if (submitBtn) submitBtn.textContent = "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

function init() {
      loadVehicleInfo();
      renderLogs();
      if (!logDate.value) setDefaultDate();

      btnSaveVehicle.addEventListener("click", saveVehicleInfo);
      btnClearVehicle.addEventListener("click", clearVehicleInfo);
      logForm.addEventListener("submit", handleFormSubmit);
      btnResetForm.addEventListener("click", resetForm);
      btnClearAllLogs.addEventListener("click", clearAllLogs);

      btnExport.addEventListener("click", exportData);
      importFile.addEventListener("change", importData);
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD6VXnzEBt0F6uzArAUbGloP3iWzVq8Qp8",
  authDomain: "atv-maintenance-387e9.firebaseapp.com",
  projectId: "atv-maintenance-387e9",
  storageBucket: "atv-maintenance-387e9.firebasestorage.app",
  messagingSenderId: "209214456252",
  appId: "1:209214456252:web:b3e8f086de56f2ad38ebb9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const stateRef = doc(db, "atv", "state");

async function ensureDoc() {
  const snap = await getDoc(stateRef);
  if (!snap.exists()) {
    await setDoc(stateRef, { vehicles: {}, current: "" });
  }
}
ensureDoc();

// üîÑ Firestore -> Local (realtime)
onSnapshot(stateRef, snap => {
  if (!snap.exists()) return;
  const data = snap.data() || {};
  localStorage.setItem("atv_multi_store", JSON.stringify({
    vehicles: data.vehicles || {},
    current: data.current || ""
  }));
  if (window.loadVehicleInfo) window.loadVehicleInfo();
  if (window.renderLogs) window.renderLogs();
});

// üåê Local -> Firestore
window.syncToCloud = async function() {
  try {
    const raw = localStorage.getItem("atv_multi_store");
    if (!raw) return;
    const data = JSON.parse(raw);
    await setDoc(stateRef, data, { merge: true });
  } catch (e) {
    console.error("sync error", e);
  }
};
</script>



<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js');
  });
}
</script>


<script>
// === Sidebar Multi-Vehicle (Mode B): true separation per vehicle ===
const MULTI_KEY = "atv_multi_store";

function getStore() {
  try {
    const raw = localStorage.getItem(MULTI_KEY);
    if (raw) return JSON.parse(raw);
  } catch(e){}
  return { vehicles: {}, current: "" };
}
function setStore(s) {
  localStorage.setItem(MULTI_KEY, JSON.stringify(s));
}
function ensureCurrent() {
  const s = getStore();
  if (!s.current) s.current = Object.keys(s.vehicles)[0] || "";
  setStore(s);
  if (window.syncToCloud) window.syncToCloud();
  return s.current;
}

// Build sidebar UI
window.addEventListener("DOMContentLoaded", () => {
  const left = document.querySelector("main.grid > section");
  if (!left || document.getElementById("vehicle-sidebar")) return;

  const card = document.createElement("div");
  card.className = "card";
  card.id = "vehicle-sidebar";
  card.innerHTML = `
    <div class="card-header">
      <div>
        <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ</h2>
        <small>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏±‡∏ô</small>
      </div>
      <button class="btn btn-ghost btn-sm" id="btnAddVehicle">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
    </div>
    <div id="vehicleList"></div>
  `;
  left.prepend(card);

  document.getElementById("btnAddVehicle").onclick = () => {
    const name = prompt("‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏ä‡πà‡∏ô ATV-01");
    if (!name) return;
    const s = getStore();
    if (s.vehicles[name]) { alert("‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß"); return; }
    s.vehicles[name] = { info: { name }, logs: [] };
    s.current = name;
    setStore(s);
  if (window.syncToCloud) window.syncToCloud();
    refreshSidebar();
    loadVehicleInfo();
    renderLogs();
  };

  refreshSidebar();
});

function refreshSidebar() {
  const list = document.getElementById("vehicleList");
  if (!list) return;
  const s = getStore();
  ensureCurrent();
  list.innerHTML = "";
  const names = Object.keys(s.vehicles);
  if (!names.length) {
    list.innerHTML = `<div class="empty-state">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏ñ ‡∏Å‡∏î ‚ûï ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏±‡∏ô‡πÅ‡∏£‡∏Å</div>`;
    return;
  }
  names.forEach(n => {
    const btn = document.createElement("button");
    btn.className = "btn btn-ghost btn-sm";
    btn.style.margin = "4px 6px 0 0";
    btn.textContent = (s.current === n ? "‚ñ∂ " : "") + n;
    btn.onclick = () => {
      const st = getStore();
      st.current = n;
      setStore(st);
      if (window.syncToCloud) window.syncToCloud();
      refreshSidebar();
      loadVehicleInfo();
      renderLogs();
    };
    list.appendChild(btn);
  });
}

// === Override core functions to be per-vehicle ===
const _loadVehicleInfo = window.loadVehicleInfo;
const _saveVehicleInfo = window.saveVehicleInfo;
const _clearVehicleInfo = window.clearVehicleInfo;
const _loadLogs = window.loadLogs;
const _saveLogs = window.saveLogs;
const _clearAllLogs = window.clearAllLogs;

window.loadVehicleInfo = function() {
  const s = getStore();
  const cur = ensureCurrent();
  if (!cur || !s.vehicles[cur]) {
    Object.values(vehicleFields).forEach(el => el.value = "");
    localStorage.removeItem(STORAGE_KEY_VEHICLE);
    updateVehicleLabel();
    refreshSidebar();
    return;
  }
  const info = s.vehicles[cur].info || {};
  vehicleFields.name.value = info.name || cur || "";
  vehicleFields.brand.value = info.brand || "";
  vehicleFields.model.value = info.model || "";
  vehicleFields.year.value = info.year || "";
  vehicleFields.purchaseDate.value = info.purchaseDate || "";
  vehicleFields.vin.value = info.vin || "";
  vehicleFields.engineNo.value = info.engineNo || "";
  vehicleFields.note.value = info.note || "";
  // sync to legacy key for compatibility
  localStorage.setItem(STORAGE_KEY_VEHICLE, JSON.stringify(info));
  updateVehicleLabel();
  refreshSidebar();
};

window.saveVehicleInfo = function() {
  const name = vehicleFields.name.value.trim();
  if (!name) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô"); return; }
  const payload = {
    name,
    brand: vehicleFields.brand.value.trim(),
    model: vehicleFields.model.value.trim(),
    year: vehicleFields.year.value.trim(),
    purchaseDate: vehicleFields.purchaseDate.value,
    vin: vehicleFields.vin.value.trim(),
    engineNo: vehicleFields.engineNo.value.trim(),
    note: vehicleFields.note.value.trim(),
  };
  const s = getStore();
  s.vehicles[name] = s.vehicles[name] || { info: {}, logs: [] };
  s.vehicles[name].info = payload;
  s.current = name;
  setStore(s);
  if (window.syncToCloud) window.syncToCloud();
  // sync to legacy key for compatibility
  localStorage.setItem(STORAGE_KEY_VEHICLE, JSON.stringify(payload));
  updateVehicleLabel();
  refreshSidebar();
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡πÅ‡∏•‡πâ‡∏ß");
};

window.clearVehicleInfo = function() {
  const s = getStore();
  const cur = ensureCurrent();
  if (!cur) return;
  if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
  delete s.vehicles[cur];
  s.current = Object.keys(s.vehicles)[0] || "";
  setStore(s);
  if (window.syncToCloud) window.syncToCloud();
  Object.values(vehicleFields).forEach(el => el.value = "");
  localStorage.removeItem(STORAGE_KEY_VEHICLE);
  refreshSidebar();
  renderLogs();
};

window.loadLogs = function() {
  const s = getStore();
  const cur = ensureCurrent();
  if (!cur || !s.vehicles[cur]) return [];
  return s.vehicles[cur].logs || [];
};

window.saveLogs = function(logs) {
  const s = getStore();
  const cur = ensureCurrent();
  if (!cur) return;
  s.vehicles[cur] = s.vehicles[cur] || { info: {}, logs: [] };
  s.vehicles[cur].logs = logs;
  setStore(s);
  if (window.syncToCloud) window.syncToCloud();
};

window.clearAllLogs = function() {
  const s = getStore();
  const cur = ensureCurrent();
  if (!cur) return;
  if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
  s.vehicles[cur].logs = [];
  setStore(s);
  if (window.syncToCloud) window.syncToCloud();
  renderLogs();
};
</script>


<script>
// === Fix: bind Export / Import buttons globally ===
window.addEventListener("DOMContentLoaded", () => {
  if (typeof exportData === "function") {
    window.exportData = exportData;
    const btn = document.getElementById("btnExport");
    if (btn) btn.onclick = () => window.exportData();
  }
  if (typeof importData === "function") {
    window.importData = importData;
    const inp = document.getElementById("importFile");
    if (inp) inp.onchange = (e) => window.importData(e);
  }
});
</script>

</body>
</html>
